<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CUDPP: /home/jwmak/Projects/cudpp/src/cudpp/app/segmented_scan_app.cu File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CUDPP
   &#160;<span id="projectnumber">2.3</span>
   </div>
   <div id="projectbrief">CUDA Data-Parallel Primitives Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_b3ac6175b5dd1357e3d0d6cbf883e90a.html">cudpp</a></li><li class="navelem"><a class="el" href="dir_85bd14a40e00dbc6f3c5b46c27c4bbb1.html">app</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">segmented_scan_app.cu File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>CUDPP application-level scan routines.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;cstdlib&gt;</code><br />
<code>#include &lt;cstdio&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &quot;cuda_util.h&quot;</code><br />
<code>#include &quot;<a class="el" href="cudpp_8h.html">cudpp.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cudpp__util_8h.html">cudpp_util.h</a>&quot;</code><br />
<code>#include &quot;cudpp_plan.h&quot;</code><br />
<code>#include &quot;cudpp_manager.h&quot;</code><br />
<code>#include &quot;<a class="el" href="segmented__scan__kernel_8cuh.html">kernel/segmented_scan_kernel.cuh</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="vector__kernel_8cuh.html">kernel/vector_kernel.cuh</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td colspan="2"><div class="groupHeader">Segmented Scan Functions</div></td></tr>
<tr class="memitem:a61831c4ecd5bbf10861cbc7b49feabec"><td class="memTemplParams" colspan="2">template&lt;typename T , class Op , bool isBackward, bool isExclusive, bool doShiftFlagsLeft&gt; </td></tr>
<tr class="memitem:a61831c4ecd5bbf10861cbc7b49feabec"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="segmented__scan__app_8cu.html#a61831c4ecd5bbf10861cbc7b49feabec">segmentedScanArrayRecursive</a> (T *d_out, const T *d_idata, const unsigned int *d_iflags, T **d_blockSums, unsigned int **d_blockFlags, unsigned int **d_blockIndices, int numElements, int level, bool sm12OrBetterHw)</td></tr>
<tr class="memdesc:a61831c4ecd5bbf10861cbc7b49feabec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform recursive scan on arbitrary size arrays.  <a href="#a61831c4ecd5bbf10861cbc7b49feabec">More...</a><br /></td></tr>
<tr class="separator:a61831c4ecd5bbf10861cbc7b49feabec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b0e55a25cddc0de09de8d55caf7ef8e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="segmented__scan__app_8cu.html#a3b0e55a25cddc0de09de8d55caf7ef8e">allocSegmentedScanStorage</a> (<a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *plan)</td></tr>
<tr class="memdesc:a3b0e55a25cddc0de09de8d55caf7ef8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate intermediate block sums, block flags and block indices arrays in a <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> class.  <a href="#a3b0e55a25cddc0de09de8d55caf7ef8e">More...</a><br /></td></tr>
<tr class="separator:a3b0e55a25cddc0de09de8d55caf7ef8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6591814174ffd2ff63491aff45f21db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="segmented__scan__app_8cu.html#ae6591814174ffd2ff63491aff45f21db">freeSegmentedScanStorage</a> (<a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *plan)</td></tr>
<tr class="memdesc:ae6591814174ffd2ff63491aff45f21db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deallocate intermediate block sums, block flags and block indices arrays in a <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> class.  <a href="#ae6591814174ffd2ff63491aff45f21db">More...</a><br /></td></tr>
<tr class="separator:ae6591814174ffd2ff63491aff45f21db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a904d82c546fba2b433621cd2fe397ae7"><td class="memTemplParams" colspan="2"><a class="anchor" id="a904d82c546fba2b433621cd2fe397ae7"></a>
template&lt;typename T , bool isBackward, bool isExclusive&gt; </td></tr>
<tr class="memitem:a904d82c546fba2b433621cd2fe397ae7"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><b>cudppSegmentedScanDispatchOperator</b> (void *d_out, const void *d_in, const unsigned int *d_iflags, int numElements, const <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *plan)</td></tr>
<tr class="separator:a904d82c546fba2b433621cd2fe397ae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8fb990d5367edbe65ec0694922f0d52"><td class="memTemplParams" colspan="2"><a class="anchor" id="ad8fb990d5367edbe65ec0694922f0d52"></a>
template&lt;bool isBackward, bool isExclusive&gt; </td></tr>
<tr class="memitem:ad8fb990d5367edbe65ec0694922f0d52"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><b>cudppSegmentedScanDispatchType</b> (void *d_out, const void *d_in, const unsigned int *d_iflags, int numElements, const <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *plan)</td></tr>
<tr class="separator:ad8fb990d5367edbe65ec0694922f0d52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ed9aebf16a673fdfd613cdd5d9d33db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="segmented__scan__app_8cu.html#a0ed9aebf16a673fdfd613cdd5d9d33db">cudppSegmentedScanDispatch</a> (void *d_out, const void *d_in, const unsigned int *d_iflags, int numElements, const <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *plan)</td></tr>
<tr class="memdesc:a0ed9aebf16a673fdfd613cdd5d9d33db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispatch function to perform a scan (prefix sum) on an array with the specified configuration.  <a href="#a0ed9aebf16a673fdfd613cdd5d9d33db">More...</a><br /></td></tr>
<tr class="separator:a0ed9aebf16a673fdfd613cdd5d9d33db"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>CUDPP application-level scan routines. </p>
<p><a class="el" href="segmented__scan__app_8cu.html" title="CUDPP application-level scan routines. ">segmented_scan_app.cu</a> </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a61831c4ecd5bbf10861cbc7b49feabec"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , class Op , bool isBackward, bool isExclusive, bool doShiftFlagsLeft&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void segmentedScanArrayRecursive </td>
          <td>(</td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>d_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const T *&#160;</td>
          <td class="paramname"><em>d_idata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int *&#160;</td>
          <td class="paramname"><em>d_iflags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T **&#160;</td>
          <td class="paramname"><em>d_blockSums</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int **&#160;</td>
          <td class="paramname"><em>d_blockFlags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int **&#160;</td>
          <td class="paramname"><em>d_blockIndices</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numElements</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>sm12OrBetterHw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform recursive scan on arbitrary size arrays. </p>
<p>This is the CPU-side workhorse function of the segmented scan engine. This function invokes the CUDA kernels which perform the segmented scan on individual blocks.</p>
<p>Scans of large arrays must be split (possibly recursively) into a hierarchy of block scans, where each block is scanned by a single CUDA thread block. At each recursive level of the segmentedScanArrayRecursive first invokes a kernel to scan all blocks of that level, and if the level has more than one block, it calls itself recursively. On returning from each recursive level, the total sum of each block from the level below is added to all elements of the first segment of the corresponding block in this level.</p>
<p>Template parameter T is the data type of the input data. Template parameter op is the binary operator of the segmented scan. Template parameter isBackward specifies whether the direction is backward (not implemented). It is forward if it is false. Template parameter isExclusive specifies whether the segmented scan is exclusive (true) or inclusive (false).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">d_out</td><td>The output array for the segmented scan results </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d_idata</td><td>The input array to be scanned </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d_iflags</td><td>The input flags vector which specifies the segments. The first element of a segment is marked by a 1 in the corresponding position in d_iflags vector. All other elements of d_iflags is 0. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d_blockSums</td><td>Array of arrays of per-block sums (one array per recursive level, allocated by <a class="el" href="group__cudpp__app.html#ga344e15dee4b3b2351c40bd9cc732bed6" title="Allocate intermediate arrays used by scan. ">allocScanStorage()</a>) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d_blockFlags</td><td>Array of arrays of per-block OR-reductions of flags (one array per recursive level, allocated by <a class="el" href="group__cudpp__app.html#ga344e15dee4b3b2351c40bd9cc732bed6" title="Allocate intermediate arrays used by scan. ">allocScanStorage()</a>) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d_blockIndices</td><td>Array of arrays of per-block min-reductions of indices (one array per recursive level, allocated by <a class="el" href="segmented__scan__app_8cu.html#a3b0e55a25cddc0de09de8d55caf7ef8e" title="Allocate intermediate block sums, block flags and block indices arrays in a CUDPPSegmentedScanPlan cl...">allocSegmentedScanStorage()</a>). An index for a particular position <code>i</code> in a block is calculated as - if <code>d_iflags</code>[i] is set then it is the 1-based index of that position (i.e if <code>d_iflags</code>[10] is set then index is <code>11</code>) otherwise the index is <code>INT_MAX</code> (the identity element of a min operator) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">numElements</td><td>The number of elements in the array to scan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">level</td><td>The current recursive level of the scan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sm12OrBetterHw</td><td>True if running on sm_12 or higher GPU, false otherwise </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3b0e55a25cddc0de09de8d55caf7ef8e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void allocSegmentedScanStorage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *&#160;</td>
          <td class="paramname"><em>plan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate intermediate block sums, block flags and block indices arrays in a <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> class. </p>
<p>Segmented scans of large arrays must be split (possibly recursively) into a hierarchy of block segmented scans, where each block is scanned by a single CUDA thread block. At each recursive level of the scan, we need an array in which to store the total sums of all blocks in that level. Also at this level we have two more arrays - one which contains the OR-reductions of flags of all blocks at that level and the second which contains the min-reductions of indices of all blocks at that levels This function computes the amount of storage needed and allocates it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">plan</td><td>Pointer to <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> object containing segmented scan options and number of elements, which is used to compute storage requirements. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae6591814174ffd2ff63491aff45f21db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void freeSegmentedScanStorage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *&#160;</td>
          <td class="paramname"><em>plan</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deallocate intermediate block sums, block flags and block indices arrays in a <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> class. </p>
<p>These arrays must have been allocated by <a class="el" href="segmented__scan__app_8cu.html#a3b0e55a25cddc0de09de8d55caf7ef8e" title="Allocate intermediate block sums, block flags and block indices arrays in a CUDPPSegmentedScanPlan cl...">allocSegmentedScanStorage()</a>, which is called by the constructor of <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">plan</td><td><a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> class initialized by its constructor. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0ed9aebf16a673fdfd613cdd5d9d33db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cudppSegmentedScanDispatch </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>d_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>d_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int *&#160;</td>
          <td class="paramname"><em>d_iflags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>numElements</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html">CUDPPSegmentedScanPlan</a> *&#160;</td>
          <td class="paramname"><em>plan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dispatch function to perform a scan (prefix sum) on an array with the specified configuration. </p>
<p>This is the dispatch routine which calls <a class="el" href="segmented__scan__app_8cu.html#a61831c4ecd5bbf10861cbc7b49feabec" title="Perform recursive scan on arbitrary size arrays. ">segmentedScanArrayRecursive()</a> with appropriate template parameters and arguments to achieve the scan as specified in <em>plan</em>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">numElements</td><td>The number of elements to scan </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">plan</td><td>Segmented Scan configuration (plan), initialized by <a class="el" href="class_c_u_d_p_p_segmented_scan_plan.html" title="Plan class for segmented scan algorithm. ">CUDPPSegmentedScanPlan</a> constructor </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d_in</td><td>The input array </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">d_iflags</td><td>The input flags array</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">d_out</td><td>The output array of segmented scan results </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 30 2016 15:29:12 for CUDPP by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
